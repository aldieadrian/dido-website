<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{layout :: head-fragment (pageTitle='Portfolio')}"></head>

<body>
<div class="mil-wrapper" id="top">
    <div th:replace="~{layout :: cursor-fragment}"></div>
    <div th:replace="~{layout :: preloader-fragment}"></div>
    <div th:replace="~{layout :: progress-track-fragment}"></div>
    <div th:replace="~{layout :: menu-fragment}"></div>
    <div th:replace="~{layout :: curtain-fragment}"></div>
    <div th:replace="~{layout :: frame-fragment}"></div>

    <div class="mil-content">
        <div id="swupMain" class="mil-main-transition">

            <div class="mil-inner-banner">
                <div class="mil-banner-content mil-up">
                    <div class="mil-animation-frame">
                        <div class="mil-animation mil-position-4 mil-dark mil-scale" data-value-1="6" data-value-2="1.4"></div>
                    </div>
                    <div class="container">
                        <ul class="mil-breadcrumbs mil-mb-60">
                            <li><a th:href="@{/}">Homepage</a></li>
                            <li><a th:href="@{/portfolio}">Portfolio</a></li>
                        </ul>
                        <h1 class="mil-mb-60">Designing a <br> Better <span class="mil-thin">World Today</span></h1>
                        <a href="#portfolio" class="mil-link mil-dark mil-arrow-place mil-down-arrow">
                            <span>Our works</span>
                        </a>
                    </div>
                </div>
            </div>

            <section id="portfolio">
                <div class="container mil-portfolio mil-p-120-60">
                    <div class="mil-lines-place"></div>
                    <div class="mil-lines-place mil-lines-long"></div>

                    <div class="row justify-content-between align-items-center" id="portfolio-container">
                        <div class="col-12 text-center">
                            <h3 class="mil-up">Loading projects...</h3>
                        </div>
                    </div>
                </div>
            </section>
            <section class="mil-soft-bg">
            </section>

        </div>
    </div>

    <div th:replace="~{layout :: footer-fragment}"></div>
</div>

<div th:replace="~{layout :: scripts-fragment}"></div>

<script>
    // Run this when the page loads
    document.addEventListener("DOMContentLoaded", function() {

        fetch('/api/portfolio')
            .then(response => response.json())
            .then(data => {
                const container = document.getElementById('portfolio-container');
                let htmlContent = '';

                if (data.length === 0) {
                    container.innerHTML = '<div class="col-12"><h3>No projects found.</h3></div>';
                    return;
                }

                // Loop through the JSON data
                data.forEach(p => {
                    // We use Backticks (`) to create the HTML string dynamically
                    htmlContent += `
                        <div class="col-lg-5">
                            <a href="/portfolio/${p.portfolioId}" class="mil-portfolio-item mil-more mil-mb-60">
                                <div class="mil-cover-frame mil-vert mil-up">
                                    <div class="mil-cover">
                                        <img src="${p.coverImageUrl}" alt="cover">
                                    </div>
                                </div>
                                <div class="mil-descr">
                                    <div class="mil-labels mil-up mil-mb-15">
                                        <div class="mil-label mil-upper mil-accent">Branding</div>
                                        <div class="mil-label mil-upper">
                                            ${new Date(p.createdTime).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}
                                        </div>
                                    </div>
                                    <h4 class="mil-up">${p.title}</h4>
                                </div>
                            </a>
                        </div>
                    `;
                });

                // Inject the HTML into the page
                container.innerHTML = htmlContent;
            })
            .catch(error => console.error('Error fetching portfolio:', error));
    });
</script>

</body>
</html>