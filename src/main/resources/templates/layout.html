<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head th:fragment="head-fragment (pageTitle)">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" th:href="@{/css/plugins/bootstrap-grid.css}">
    <link rel="stylesheet" th:href="@{/css/plugins/font-awesome.min.css}">
    <link rel="stylesheet" th:href="@{/css/plugins/swiper.min.css}">
    <link rel="stylesheet" th:href="@{/css/plugins/fancybox.min.css}">
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <title th:text="${pageTitle} + ' - DIDO Creative Studio'">DIDO Creative</title>
</head>

<body>
<div class="mil-ball" th:fragment="cursor-fragment">
    <span class="mil-icon-1"><svg viewBox="0 0 128 128"><path d="M106.1,41.9c-1.2-1.2-3.1-1.2-4.2,0c-1.2,1.2-1.2,3.1,0,4.2L116.8,61H11.2l14.9-14.9c1.2-1.2,1.2-3.1,0-4.2	c-1.2-1.2-3.1-1.2-4.2,0l-20,20c-1.2,1.2-1.2,3.1,0,4.2l20,20c0.6,0.6,1.4,0.9,2.1,0.9s1.5-0.3,2.1-0.9c1.2-1.2,1.2-3.1,0-4.2	L11.2,67h105.5l-14.9,14.9c-1.2,1.2-1.2,3.1,0,4.2c0.6,0.6,1.4,0.9,2.1,0.9s1.5-0.3,2.1-0.9l20-20c1.2-1.2,1.2-3.1,0-4.2L106.1,41.9	z" /></svg></span>
    <div class="mil-more-text">More</div>
    <div class="mil-choose-text">Ð¡hoose</div>
</div>

<div class="mil-preloader" th:fragment="preloader-fragment">
    <div class="mil-preloader-animation">
        <div class="mil-pos-abs mil-animation-1"><p class="mil-h3 mil-muted mil-thin">Pioneering</p><p class="mil-h3 mil-muted">Creative</p><p class="mil-h3 mil-muted mil-thin">Excellence</p></div>
        <div class="mil-pos-abs mil-animation-2"><div class="mil-reveal-frame"><p class="mil-reveal-box"></p><p class="mil-h3 mil-muted mil-thin">didocreative.com</p></div></div>
    </div>
</div>

<div class="mil-progress-track" th:fragment="progress-track-fragment">
    <div class="mil-progress"></div>
</div>

<div class="mil-menu-frame" th:fragment="menu-fragment">
    <div class="mil-frame-top"><a th:href="@{/}" class="mil-logo">DIDO.</a><div class="mil-menu-btn"><span></span></div></div>
    <div class="container">
        <div class="mil-menu-content">
            <div class="row">
                <div class="col-xl-5">
                    <nav class="mil-main-menu" id="swupMenu">
                        <ul>
                            <li><a th:href="@{/}">Homepage</a></li>
                            <li><a th:href="@{/portfolio}">Portfolio</a></li>
                            <li><a th:href="@{/services}">Services</a></li>
                            <li><a th:href="@{/cases}">Cases</a></li>
                            <li><a th:href="@{/about}">About Us</a></li>
                            <li><a th:href="@{/contact}">Contact</a></li>
                        </ul>
                    </nav>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="mil-curtain" th:fragment="curtain-fragment"></div>

<div class="mil-frame" th:fragment="frame-fragment">
    <div class="mil-frame-top"><a th:href="@{/}" class="mil-logo">DIDO.</a><div class="mil-menu-btn"><span></span></div></div>
    <div class="mil-frame-bottom"><div class="mil-current-page"></div><div class="mil-back-to-top"><a href="#top" class="mil-link mil-dark mil-arrow-place"><span>Back to top</span></a></div></div>
</div>

<footer class="mil-dark-bg" th:fragment="footer-fragment">
    <div class="mi-invert-fix">
        <div class="container mil-p-120-60">
            <div class="mil-mb-30">
                <ul class="mil-social-icons mil-up">
                    <li><a href="#." target="_blank" class="social-icon"> <i class="far fa-circle"></i></a></li>
                    <li><a href="#." target="_blank" class="social-icon"> <i class="far fa-circle"></i></a></li>
                    <li><a href="#." target="_blank" class="social-icon"> <i class="far fa-circle"></i></a></li>
                </ul>
            </div>
        </div>
    </div>
</footer>

<div th:fragment="scripts-fragment">

    <script th:src="@{/js/plugins/jquery.min.js}"></script>
    <script th:src="@{/js/plugins/swup.min.js}"></script> <script th:src="@{/js/plugins/swiper.min.js}"></script>
    <script th:src="@{/js/plugins/fancybox.min.js}"></script>
    <script th:src="@{/js/plugins/gsap.min.js}"></script>
    <script th:src="@{/js/plugins/smooth-scroll.js}"></script>
    <script th:src="@{/js/plugins/ScrollTrigger.min.js}"></script>
    <script th:src="@{/js/plugins/ScrollTo.min.js}"></script>
    <script th:src="@{/js/main.js}"></script> <script>
    // --- 1. DEFINE ALL OUR FUNCTIONS ---

    function loadPortfolioData() {
        const container = document.getElementById('portfolio-container');
        if (!container) return; // Not on portfolio page, exit

        fetch('/api/portfolio')
            .then(response => response.json())
            .then(data => {
                let htmlContent = '';
                if (data.length === 0) {
                     container.innerHTML = '<div class="col-12"><h3>No projects found.</h3></div>';
                     return;
                }
                data.forEach(p => {
                    const date = new Date(p.createdTime).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
                    htmlContent += `
                        <div class="col-lg-5">
                            <a href="/portfolio/${p.portfolioId}" class="mil-portfolio-item mil-more mil-mb-60">
                                <div class="mil-cover-frame mil-vert mil-up"><div class="mil-cover"><img src="${p.coverImageUrl}" alt="cover"></div></div>
                                <div class="mil-descr">
                                    <div class="mil-labels mil-up mil-mb-15">
                                        <div class="mil-label mil-upper mil-accent">Branding</div>
                                        <div class="mil-label mil-upper">${date}</div>
                                    </div>
                                    <h4 class="mil-up">${p.title}</h4>
                                </div>
                            </a>
                        </div>
                    `;
                });
                container.innerHTML = htmlContent;
            })
            .catch(error => {
                console.error('Error fetching portfolio:', error);
                container.innerHTML = '<div class="col-12"><h3>Error loading projects.</h3></div>';
            });
    }

    function loadCaseStudiesData() {
        const container = document.getElementById('cases-container');
        if (!container) return; // Not on cases page, exit

        fetch('/api/cases')
            .then(response => response.json())
            .then(data => {
                let htmlContent = '';
                if (data.length === 0) {
                     container.innerHTML = '<h3 class="mil-up">No case studies found.</h3>';
                     return;
                }
                data.forEach(cs => {
                    const date = new Date(cs.createdTime).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
                    htmlContent += `
                        <a href="/cases/${cs.caseStudyId}" class="mil-blog-card mil-blog-card-hori mil-more mil-mb-60">
                            <div class="mil-cover-frame mil-up"><img src="${cs.coverImageUrl}" alt="cover"></div>
                            <div class="mil-post-descr">
                                <div class="mil-labels mil-up mil-mb-30">
                                    <div class="mil-label mil-upper mil-accent">Case Study</div>
                                    <div class="mil-label mil-upper">${date}</div>
                                </div>
                                <h4 class="mil-up mil-mb-30">${cs.title}</h4>
                                <p class="mil-post-text mil-up mil-mb-30">Click to read more...</p>
                                <div class="mil-link mil-dark mil-arrow-place mil-up"><span>Read more</span></div>
                            </div>
                        </a>
                    `;
                });
                container.innerHTML = htmlContent;
            })
            .catch(error => {
                console.error('Error fetching case studies:', error);
                container.innerHTML = '<h3 class="mil-up">Error loading content.</h3>';
            });
    }

    function loadPortfolioDetailData() {
        const container = document.getElementById('dynamic-sections-container');
        if (!container || !window.location.pathname.startsWith('/portfolio/')) return;

        const pathArray = window.location.pathname.split('/');
        const id = pathArray[pathArray.length - 1];

        fetch('/api/portfolio/' + id)
            .then(response => {
                if (!response.ok) throw new Error("Not Found: " + response.status);
                return response.json(); // THIS WAS A BUG: I didn't return response.json()
            })
            .then(dto => {
                const p = dto.portfolio;
                document.title = p.title + ' - DIDO Creative Studio';
                document.getElementById('dynamic-title').innerText = p.title;
                document.getElementById('dynamic-breadcrumb').innerText = p.title;
                document.getElementById('dynamic-cover-img').src = p.coverImageUrl;
                document.getElementById('dynamic-date').innerText = new Date(p.createdTime).toLocaleDateString('en-US', { month: 'long', year: 'numeric' });

                let sectionsHtml = '';
                // ... (rest of the DTO-parsing logic is the same) ...
                container.innerHTML = sectionsHtml;
            })
            .catch(error => {
                console.error('Error fetching portfolio detail:', error);
                const titleEl = document.getElementById('dynamic-title');
                if (titleEl) titleEl.innerText = "Project Not Found";
            });
    }

    function loadCaseDetailData() {
        const container = document.getElementById('dynamic-content-container');
        if (!container || !window.location.pathname.startsWith('/cases/')) return;

        const pathArray = window.location.pathname.split('/');
        const id = pathArray[pathArray.length - 1];

        fetch('/api/cases/' + id)
            .then(response => {
                if (!response.ok) throw new Error("Not Found: " + response.status);
                return response.json(); // THIS WAS A BUG: I didn't return response.json()
            })
            .then(dto => {
                const cs = dto.caseStudy;
                document.title = cs.title + ' - DIDO Creative Studio';
                document.getElementById('dynamic-title').innerText = cs.title;
                // ... (rest of the DTO-parsing logic) ...
                container.innerHTML = sectionsHtml;
            })
            .catch(error => {
                console.error('Error fetching case detail:', error);
                const titleEl = document.getElementById('dynamic-title');
                if (titleEl) titleEl.innerText = "Case Study Not Found";
            });
    }

    // --- 3. MASTER FUNCTION TO RUN ALL CHECKS ---
    function runAllDataLoaders() {
        loadPortfolioData();
        loadCaseStudiesData();
        loadPortfolioDetailData();
        loadCaseDetailData();
    }

    // --- 4. THE HOOKS ---

    // Run once on initial page load
    document.addEventListener('DOMContentLoaded', runAllDataLoaders);

    // Run every time swup swaps content
    document.addEventListener('swup:page:view', runAllDataLoaders);

</script>
</div>

</body>
</html>