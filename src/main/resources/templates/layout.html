<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head th:fragment="head-fragment (pageTitle)">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" th:href="@{/css/plugins/bootstrap-grid.css}">
    <link rel="stylesheet" th:href="@{/css/plugins/font-awesome.min.css}">
    <link rel="stylesheet" th:href="@{/css/plugins/swiper.min.css}">
    <link rel="stylesheet" th:href="@{/css/plugins/fancybox.min.css}">
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <title th:text="${pageTitle} + ' - DIDO Creative Studio'">DIDO Creative</title>
</head>

<body>

<!-- ========== CURSOR ========== -->
<div class="mil-ball" th:fragment="cursor-fragment">
    <span class="mil-icon-1"><svg viewBox="0 0 128 128"><path d="M106.1,41.9c-1.2-1.2-3.1-1.2-4.2,0c-1.2,1.2-1.2,3.1,0,4.2L116.8,61H11.2l14.9-14.9c1.2-1.2,1.2-3.1,0-4.2 c-1.2-1.2-3.1-1.2-4.2,0l-20,20c-1.2,1.2-1.2,3.1,0,4.2l20,20c0.6,0.6,1.4,0.9,2.1,0.9s1.5-0.3,2.1-0.9c1.2-1.2,1.2-3.1,0-4.2 L11.2,67h105.5l-14.9,14.9c-1.2,1.2-1.2,3.1,0,4.2c0.6,0.6,1.4,0.9,2.1,0.9s1.5-0.3,2.1-0.9l20-20c1.2-1.2,1.2-3.1,0-4.2 L106.1,41.9z"/></svg></span>
    <div class="mil-more-text">More</div>
    <div class="mil-choose-text">Choose</div>
</div>

<!-- ========== PRELOADER ========== -->
<div class="mil-preloader" th:fragment="preloader-fragment">
    <div class="mil-preloader-animation">
        <div class="mil-pos-abs mil-animation-1">
            <p class="mil-h3 mil-muted mil-thin">Pioneering</p>
            <p class="mil-h3 mil-muted">Creative</p>
            <p class="mil-h3 mil-muted mil-thin">Excellence</p>
        </div>
        <div class="mil-pos-abs mil-animation-2">
            <div class="mil-reveal-frame">
                <p class="mil-reveal-box"></p>
                <p class="mil-h3 mil-muted mil-thin">didocreative.com</p>
            </div>
        </div>
    </div>
</div>

<!-- ========== PROGRESS TRACK ========== -->
<div class="mil-progress-track" th:fragment="progress-track-fragment">
    <div class="mil-progress"></div>
</div>

<!-- ========== MENU ========== -->
<div class="mil-menu-frame" th:fragment="menu-fragment">
    <div class="mil-frame-top">
        <a th:href="@{/}" class="mil-logo">DIDO.</a>
        <div class="mil-menu-btn"><span></span></div>
    </div>
    <div class="container">
        <div class="mil-menu-content">
            <div class="row">
                <div class="col-xl-5">
                    <nav class="mil-main-menu" id="swupMenu">
                        <ul>
                            <li><a th:href="@{/}">Homepage</a></li>
                            <li><a th:href="@{/portfolio}">Portfolio</a></li>
                            <li><a th:href="@{/services}">Services</a></li>
                            <li><a th:href="@{/cases}">Cases</a></li>
                            <li><a th:href="@{/about}">About Us</a></li>
                            <li><a th:href="@{/contact}">Contact</a></li>
                        </ul>
                    </nav>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- ========== CURTAIN ========== -->
<div class="mil-curtain" th:fragment="curtain-fragment"></div>

<!-- ========== FRAME ========== -->
<div class="mil-frame" th:fragment="frame-fragment">
    <div class="mil-frame-top">
        <a th:href="@{/}" class="mil-logo">DIDO.</a>
        <div class="mil-menu-btn"><span></span></div>
    </div>
    <div class="mil-frame-bottom">
        <div class="mil-current-page"></div>
        <div class="mil-back-to-top">
            <a href="#top" class="mil-link mil-dark mil-arrow-place"><span>Back to top</span></a>
        </div>
    </div>
</div>

<!-- ========== FOOTER ========== -->
<footer class="mil-dark-bg" th:fragment="footer-fragment">
    <div class="mi-invert-fix">
        <div class="container mil-p-120-60">
            <div class="mil-mb-30">
                <ul class="mil-social-icons mil-up">
                    <li><a href="#." class="social-icon"><i class="far fa-circle"></i></a></li>
                    <li><a href="#." class="social-icon"><i class="far fa-circle"></i></a></li>
                    <li><a href="#." class="social-icon"><i class="far fa-circle"></i></a></li>
                </ul>
            </div>
        </div>
    </div>
</footer>

<!-- ========== SCRIPTS ========== -->
<div th:fragment="scripts-fragment">

    <script th:src="@{/js/plugins/jquery.min.js}"></script>
    <script th:src="@{/js/plugins/swup.min.js}"></script>
    <script th:src="@{/js/plugins/swiper.min.js}"></script>
    <script th:src="@{/js/plugins/fancybox.min.js}"></script>
    <script th:src="@{/js/plugins/gsap.min.js}"></script>
    <script th:src="@{/js/plugins/smooth-scroll.js}"></script>
    <script th:src="@{/js/plugins/ScrollTrigger.min.js}"></script>
    <script th:src="@{/js/plugins/ScrollTo.min.js}"></script>

    <script th:src="@{/js/main.js}"></script>

    <!-- ======================================================
         ⚡ DYNAMIC PAGE DATA LOADER — FINAL FIXED VERSION
         Works for:
         - portfolio page list
         - portfolio detail
         - case studies list
         - case study detail
         Fully compatible with Swup transitions
    ======================================================== -->
    <script>

        /* -----------------------------------------
           LOADERS
        ----------------------------------------- */

        function loadPortfolioData() {
            const container = document.getElementById('portfolio-container');
            if (!container) return;

            fetch('/api/portfolio')
                .then(r => r.json())
                .then(data => {
                    if (!data.length) {
                        container.innerHTML = `<div class="col-12 text-center"><h3>No projects found.</h3></div>`;
                        return;
                    }

                    let html = "";
                    data.forEach(p => {
                        const date = new Date(p.createdTime)
                                .toLocaleDateString("en-US",
                                    { month: "short", day: "numeric", year: "numeric" });

                        html += `
                            <div class="col-lg-5">
                                <a href="/portfolio/${p.portfolioId}" class="mil-portfolio-item mil-more mil-mb-60">
                                    <div class="mil-cover-frame mil-vert">
                                        <div class="mil-cover"><img src="${p.coverImageUrl}" alt="cover"></div>
                                    </div>
                                    <div class="mil-descr">
                                        <div class="mil-labels mil-mb-15">
                                            <div class="mil-label mil-upper mil-accent">Branding</div>
                                            <div class="mil-label mil-upper">${date}</div>
                                        </div>
                                        <h4>${p.title}</h4>
                                    </div>
                                </a>
                            </div>`;
                    });

                    container.innerHTML = html;
                });
        }


        function loadCaseStudiesData() {
            const container = document.getElementById('cases-container');
            if (!container) return;

            fetch('/api/cases')
                .then(r => r.json())
                .then(data => {
                    if (!data.length) {
                        container.innerHTML = `<h3>No case studies found.</h3>`;
                        return;
                    }

                    let html = "";
                    data.forEach(cs => {
                        const date = new Date(cs.createdTime)
                            .toLocaleDateString("en-US",
                                { month: "short", day: "numeric", year: "numeric" });

                        html += `
                            <a href="/cases/${cs.caseStudyId}"
                               class="mil-blog-card mil-blog-card-hori mil-more mil-mb-60">

                                <div class="mil-cover-frame">
                                    <img src="${cs.coverImageUrl}" alt="cover">
                                </div>

                                <div class="mil-post-descr">
                                    <div class="mil-labels mil-mb-30">
                                        <div class="mil-label mil-upper mil-accent">Case Study</div>
                                        <div class="mil-label mil-upper">${date}</div>
                                    </div>

                                    <h4 class="mil-mb-30">${cs.title}</h4>
                                    <p class="mil-post-text mil-mb-30">
                                        Click to read more about this project and our process.
                                    </p>

                                    <div class="mil-link mil-dark mil-arrow-place">
                                        <span>Read more</span>
                                    </div>
                                </div>
                            </a>`;
                    });

                    container.innerHTML = html;
                });
        }


        /* -----------------------------------------
           MASTER LOADER — FIX UNTUK SWUP
        ----------------------------------------- */

        function runAll() {
            loadPortfolioData();
            loadCaseStudiesData();
            loadPortfolioDetailData();
            loadCaseDetailData();
        }

        // 1) Direct load (first time open browser / refresh)
        document.addEventListener("DOMContentLoaded", runAll);

        // 2) Swup navigation (AFTER it finishes replacing HTML)
        document.addEventListener("swup:contentReplaced", runAll);

    </script>

</div>

</body>
</html>
